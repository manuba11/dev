<!DOCTYPE html>
<html lang="ja">
<!-- Write with HTML5-->
<head>
<meta charset="UTF-8" />
<title>Measure the temperature and humidity on home.</title>
<!--

-->
<style>
div.valuebox
{
    color: red;
    text-align: center;
    font-size: 300%;

    border: 1px solid powderblue;
    margin: 10px;
    padding: 10px;
    background-color: lightgray;
}

</style>
</head>
<body>
    <h1>Measure the temperature and humidity on home.</h1>

    <form id = "frmMain" onsubmit = "return false;">
    </form>

    <div id = "div1" class = "valuebox"></div>
    <div id = "div2" class = "valuebox"></div>
    <div id = "div3" class = "valuebox"></div>

    <!-- Start Javascript -->
    <script language = "javascript" type = "text/javascript">
        <!-- Write the code below this. -->

        const BASE_PATH = 'https://us.wio.seeed.io/v1/node/';
        const EP_LIGHT = 'GenericAInA0/analog';
        const EP_HUMIDITY = 'GroveTempHumD0/humidity';
        const EP_TEMPERATURE = 'GroveTempHumD0/temperature';
        const STR_URI = '?access_token=';

        const TOKEN = 'e39640809dc7129f0cfca3c065013215';

        var output1 = document.getElementById("div1");
        var output2 = document.getElementById("div2");
        var output3 = document.getElementById("div3");

        var strTemperature = BASE_PATH + EP_TEMPERATURE + STR_URI + TOKEN;
        var strHumidity = BASE_PATH + EP_HUMIDITY + STR_URI + TOKEN;
        var strLight = BASE_PATH + EP_LIGHT + STR_URI + TOKEN;

        //https://code.i-harness.com/ja/q/d6a30
        
        var makeHttpObject = function() {
              try {return new XMLHttpRequest();}
                  catch (error) {}
        //              try {return new ActiveXObject("Msxml2.XMLHTTP");}
        //                  catch (error) {}
        //              try {return new ActiveXObject("Microsoft.XMLHTTP");}
        //                  catch (error) {}
            
              throw new Error("Could not create HTTP request object.");
        }

        //https://techacademy.jp/magazine/5537
        //https://www.w3schools.com/Js/js_json_parse.asp
        var getSensorValue = function()
        {
            var request1 = makeHttpObject();
            //output1.innerHTML = strTemperature;
            request1.open("GET", strTemperature, true);
            request1.send(null);
            request1.onreadystatechange = function() {
              if (request1.readyState == 4)
                var objDegree = JSON.parse(request1.responseText);
                output1.innerHTML = "Temparature : " + objDegree.celsius_degree;
            };
    
            var request2 = makeHttpObject();
            //output2.innerHTML = strHumidity;
            request2.open("GET", strHumidity, true);
            request2.send(null);
            request2.onreadystatechange = function() {
              if (request2.readyState == 4)
                var objHumidity = JSON.parse(request2.responseText);
                output2.innerHTML = "Humidity : " + objHumidity.humidity;
            };
    
            var request3 = makeHttpObject();
            //output3.innerHTML = strLight;
            request3.open("GET", strLight, true);
            request3.send(null);
            request3.onreadystatechange = function() {
              if (request3.readyState == 4)
                var objLight = JSON.parse(request3.responseText);
                output3.innerHTML = "Light : " + objLight.analog;
            };
        }
        //https://techacademy.jp/magazine/5537
        //Interval in millisecond
        getSensorValue();
        setInterval(getSensorValue, 60000);
    </script>
</body>
</html>

